{"version":3,"sources":["../../src/middlewares/auth.middleware.ts"],"sourcesContent":["import { NextFunction, Response } from 'express';\nimport { verify } from 'jsonwebtoken';\nimport { SECRET_KEY } from '@config';\nimport { HttpException } from '@exceptions/HttpException';\nimport { DataStoredInToken, RequestWithUser } from '@interfaces/auth.interface';\nimport userModel from '@models/users.model';\n\nconst authMiddleware = async (req: RequestWithUser, res: Response, next: NextFunction) => {\n  try {\n    const Authorization = req.cookies['Authorization'] || (req.header('Authorization') ? req.header('Authorization').split('Bearer ')[1] : null);\n\n    if (Authorization) {\n      const secretKey: string = SECRET_KEY;\n      const verificationResponse = (await verify(Authorization, secretKey)) as DataStoredInToken;\n      const userId = verificationResponse.id;\n      const findUser = userModel.find(user => user.id === userId);\n\n      if (findUser) {\n        req.user = findUser;\n        next();\n      } else {\n        next(new HttpException(401, 'Wrong authentication token'));\n      }\n    } else {\n      next(new HttpException(404, 'Authentication token missing'));\n    }\n  } catch (error) {\n    next(new HttpException(401, 'Wrong authentication token'));\n  }\n};\n\nexport default authMiddleware;\n"],"names":["authMiddleware","req","res","next","Authorization","cookies","header","split","secretKey","SECRET_KEY","verificationResponse","verify","userId","id","findUser","userModel","find","user","HttpException","error"],"mappings":"AAAA;;;;+BA+BA,SAA8B;;aAA9B,QAA8B;;8BA9BP,cAAc;wBACV,WAAS;+BACN,6BAA2B;mDAEnC,uBAAqB;;;;;;AAE3C,MAAMA,cAAc,GAAG,OAAOC,GAAoB,EAAEC,GAAa,EAAEC,IAAkB,GAAK;IACxF,IAAI;QACF,MAAMC,aAAa,GAAGH,GAAG,CAACI,OAAO,CAAC,eAAe,CAAC,IAAKJ,CAAAA,GAAG,CAACK,MAAM,CAAC,eAAe,CAAC,GAAGL,GAAG,CAACK,MAAM,CAAC,eAAe,CAAC,CAACC,KAAK,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,GAAG,IAAI,CAAA,AAAC,AAAC;QAE7I,IAAIH,aAAa,EAAE;YACjB,MAAMI,SAAS,GAAWC,OAAU,WAAA,AAAC;YACrC,MAAMC,oBAAoB,GAAI,MAAMC,IAAAA,aAAM,OAAA,EAACP,aAAa,EAAEI,SAAS,CAAC,AAAsB,AAAC;YAC3F,MAAMI,MAAM,GAAGF,oBAAoB,CAACG,EAAE,AAAC;YACvC,MAAMC,QAAQ,GAAGC,WAAS,QAAA,CAACC,IAAI,CAACC,CAAAA,IAAI,GAAIA,IAAI,CAACJ,EAAE,KAAKD,MAAM,CAAC,AAAC;YAE5D,IAAIE,QAAQ,EAAE;gBACZb,GAAG,CAACgB,IAAI,GAAGH,QAAQ,CAAC;gBACpBX,IAAI,EAAE,CAAC;YACT,OAAO;gBACLA,IAAI,CAAC,IAAIe,cAAa,cAAA,CAAC,GAAG,EAAE,4BAA4B,CAAC,CAAC,CAAC;YAC7D,CAAC;QACH,OAAO;YACLf,IAAI,CAAC,IAAIe,cAAa,cAAA,CAAC,GAAG,EAAE,8BAA8B,CAAC,CAAC,CAAC;QAC/D,CAAC;IACH,EAAE,OAAOC,KAAK,EAAE;QACdhB,IAAI,CAAC,IAAIe,cAAa,cAAA,CAAC,GAAG,EAAE,4BAA4B,CAAC,CAAC,CAAC;IAC7D,CAAC;AACH,CAAC,AAAC;MAEF,QAA8B,GAAflB,cAAc"}